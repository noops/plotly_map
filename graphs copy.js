function init() {
    var selector = d3.select("#selDataset");
    //inside data object, contains prices, states, and cpt codes 
    d3.json("prices.json").then((data) => {
      console.log(data);
      var stateName = data.index;
      console.log(stateName);
      console.log(data.index);
      stateName.forEach((state) => {
        selector.append("option").text(state).property("value", state)
      });
      
  })}

  init();
  buildMetadata("AK")
  buildCharts("AK")
  buildMap()


//takes user selected state from dropdown menu
function optionChanged(newState){
    buildMetadata(newState);
    buildCharts(newState);
}



//when dropdown menu option is selected id number is passed in as sample
function buildMetadata(state){
    d3.json("prices.json").then((data) => {
        var priceData = data.data;
        var stateName = data.index;
        var cptCode = data.columns;
        // sets stateIndex equal to the index number of the state being passed in. this allows us to access the correct price data. 
        var stateIndex = stateName.indexOf(state);

        var PANEL = d3.select("#sample-metadata");
        //ensures contents are cleared when another id number is chosen
        PANEL.html("");

        //combines cptCode array with priceData array at correct index 
        var priceInfo = cptCode.concat(priceData[stateIndex]);

        var newArray = priceData[stateIndex];

        //maps cptCode to pricing info for correct state 
        var priceArray = cptCode.map((e, i) => e + newArray[i]);

        //updates panel with pricing info
        priceArray.forEach((price) => {
            PANEL.append("h6").text(price)
        });
    });
} 


function buildCharts(state){
    d3.json("prices.json").then((data) => {
        var priceData = data.data;
        var stateName = data.index;
        var cptCode = data.columns;

        var stateIndex = stateName.indexOf(state);

        var newArray = priceData[stateIndex];

        var priceArray = cptCode.map((e, i) => e + newArray[i]);

        

        var bubbleChart = {
            x: cptCode,
            y: priceData[stateIndex],
            text: cptCode,
            mode: "markers",
            marker: {
                size: 50,
                color: priceData[stateIndex]
            }
        };
        var layoutBubble = {
            title: "Average Price",
            xaxis: {title: "Procedure"},
            yaxis: {title: "Price"}

        };
        Plotly.newPlot("bubble", [bubbleChart], layoutBubble);

        var barChart = {
            x: cptCode,
            y: priceData[stateIndex],
            text: cptCode,
            type: "bar",
            orientation: "v"
        };
        var layoutBar = {
            title: "Average Price",
            xaxis: {title:"Procedure"},
            yaxis: {title:"Price"}

        };
        Plotly.newPlot("bar", [barChart], layoutBar);

        
    });    
}

function buildMap(){
        var map = [{
            type: 'scattermapbox',
            mode: 'markers',
            lon: [-148.0, -86.56, -85.7, -86.81, -86.74, -86.79, -85.9, -87.67, -86.7, -86.74, -85.5, -87.7, -88.3, -85.9, -86.8, -86.14, -85.9, -90.9, -93.1, -94.0, -94.5, -92.3, -92.6, -94.1, -92.5, -93.0, -94.3, -92.5, -92.35, -111.58, -112.03, -112.11, -110.9, -111.8, -111.88, -110.89, -111.74, -112.05, -112.9, -112.0, -112.19, -111.86, -112.06, -112.32, -112.01, -111.74, -111.5, -112.1, -110.98, -110.0, -110.98, -112.1, -111.88, -112.07, -111.74, -112.4, -110.1, -112.33, -112.23, -111.88, -111.07, -112.1, -112.5, -112.28, -112.03, -109.5, -112.4, -114.5, -112.18, -110.91, -112.36, -111.72, -112.0, -111.92, -119.8, -117.07, -121.32, -122.41, -121.7, -117.05, -118.29, -122.55, -122.54, -117.2, -117.12, -122.21, -117.1, -119.83, -117.71, -122.09, -118.381, -122.42, -121.84, -117.26, -117.17, -121.92, -117.45, -117.25, -117.01, -117.09, -121.4, -117.29, -122.48, -104.5, -104.97, -105.15, -104.77, -104.98, -104.84, -105.1, -105.13, -105.2, -105.12, -104.85, -104.87, -105.01, -104.9, -105.01, -105.1, -104.96, -104.8, -75.4, -75.6, -75.7, -75.7, -75.53, -75.5, -75.6, -75.59, -80.75, -81.6, -80.17, -81.43, -80.18, -81.29, -85.67, -80.1, -82.5, -82.46, -81.7, -81.49, -82.18, -81.45, -80.23, -81.94, -81.73, -80.33, -82.6, -80.24, -81.91, -82.43, -80.24, -80.4, -81.44, -82.62, -82.64, -82.12, -82.79, -80.33, -87.0, -81.44, -82.51, -82.04, -81.9, -80.09, -80.21, -80.27, -80.37, -81.16, -86.4, -80.09, -81.5, -80.24, -82.45, -80.14, -81.61, -82.21, -82.69, -80.29, -80.27, -80.18, -82.6, -81.36, -82.62, -80.2, -82.36, -81.2, -81.25, -80.06, -81.29, -81.3, -80.27, -80.09, -80.08, -82.73, -81.75, -81.37, -82.73, -82.2, -81.42, -80.16, -82.76, -81.35, -81.75, -81.2, -81.36, -80.26, -81.3, -80.6, -80.19, -82.47, -87.21, -86.4, -80.62, -81.46, -82.45, -82.63, -81.58, -82.52, -80.14, -81.68, -81.72, -81.92, -80.17, -81.3, -80.13, -82.39, -82.3, -82.3, -81.54, -80.11, -81.36, -82.3, -81.49, -80.12, -81.7, -81.32, -81.43, -81.8, -81.4, -81.36, -82.09, -82.35, -82.4, -80.3, -80.15, -81.58, -84.32, -84.48, -84.23, -83.57, -84.29, -84.3, -84.39, -83.7, -84.29, -84.98, -83.62, -84.2, -83.45, -83.2, -83.8, -84.7, -83.44, -85.24, -84.65, -82.5, -84.1, -84.15, -84.2, -84.44, -84.3, -84.42, -84.92, -84.0, -81.9, -85.01, -84.28, -84.01, -84.31, -84.54, -84.57, -91.59, -95.9, -95.8, -94.8, -91.0, -87.89, -88.08, -90.3, -87.85, -87.76, -89.5, -88.22, -88.08, -89.21, -89.4, -87.93, -89.01, -87.64, -88.02, -88.05, -88.13, -90.4, -87.65, -87.79, -88.06, -88.08, -87.78, -87.66, -87.94, -89.7, -87.99, -88.6, -88.31, -88.14, -88.9, -87.87, -89.91, -88.9, -87.93, -87.44, -86.6, -85.11, -87.17, -85.11, -86.2, -87.0, -85.16, -86.18, -85.24, -86.3, -87.05, -86.7, -86.9, -85.08, -87.5, -87.24, -85.97, -85.9, -86.14, -85.6, -87.47, -97.32, -94.78, -95.35, -94.8, -97.28, -97.9, -97.5, -94.7, -97.28, -97.22, -95.36, -97.2, -96.8, -94.8, -97.28, -96.6, -94.77, -95.2, -97.0, -94.64, -97.2, -97.335, -85.84, -82.7, -84.54, -84.37, -84.03, -84.3, -83.9, -84.4, -84.6, -82.8, -85.5, -90.19, -93.23, -92.47, -93.71, -92.6, -92.11, -92.53, -70.87, -71.43, -70.24, -70.48, -71.39, -71.0, -71.18, -71.81, -71.76, -71.0, -71.15, -70.06, -71.16, -71.55, -70.95, -71.18, -72.59, -71.12, -71.061, -70.94, -71.04, -73.3, -70.96, -71.35, -71.29, -72.31, -72.6, -71.3, -71.07, -72.63, -71.77, -76.54, -77.08, -77.19, -76.69, -76.71, -76.3, -76.0, -76.75, -76.49, -76.64, -76.8, -76.1, -76.88, -76.9, -76.99, -76.64, -83.01, -83.72, -83.7, -83.3, -83.5, -83.7, -83.16, -83.2, -83.46, -83.14, -83.2, -83.8, -92.6, -90.9, -90.5, -90.33, -94.59, -94.58, -91.4, -94.6, -94.41, -93.25, -90.45, -94.48, -94.3, -94.8, -90.36, -94.41, -90.63, -90.38, -94.58, -92.4, -90.09, -88.9, -89.0, -90.8, -90.23, -90.16, -91.4, -89.9, -89.4, -90.0, -89.1, -108.7, -80.85, -79.74, -80.9, -78.3, -80.89, -77.71, -78.61, -80.69, -77.9, -77.98, -77.4, -82.52, -80.9, -96.19, -97.8, -96.07, -96.2, -96.05, -96.05, -98.4, -99.0, -96.19, -95.9, -96.65, -75.4, -75.3, -103.4, -103.3, -106.7, -104.3, -104.3, -115.17, -115.3, -115.16, -115.09, -115.09, -115.29, -115.27, -114.3, -73.96, -81.54, -82.5, -81.92, -81.9, -83.8, -83.6, -84.17, -81.73, -81.79, -80.67, -97.1, -96.9, -97.57, -97.2, -96.4, -96.8, -98.49, -97.46, -97.1, -95.9, -97.64, -97.76, -97.8, -97.3, -99.0, -95.81, -99.4, -98.0, -97.52, -97.4, -97.42, -95.7, -97.34, -99.9, -96.6, -97.56, -97.3, -97.5, -97.43, -97.52, -97.33, -95.81, -95.8, -122.8, -75.63, -75.38, -76.3, -75.34, -75.95, -74.89, -75.33, -75.89, -75.5, -79.99, -77.67, -75.84, -75.8, -75.42, -75.05, -75.04, -75.23, -75.8, -75.31, -75.01, -75.54, -79.84, -75.6, -75.7, -75.31, -75.36, -75.32, -75.9, -75.7, -75.62, -75.53, -80.04, -71.43, -71.36, -79.7, -80.7, -81.1, -80.93, -82.38, -80.8, -80.9, -81.02, -81.2, -82.6, -84.18, -85.5, -83.2, -87.4, -86.87, -85.27, -86.5, -86.2, -85.7, -86.0, -85.8, -84.9, -84.05, -85.21, -86.3, -97.5, -95.84, -99.2, -97.77, -98.0, -94.1, -97.29, -101.89, -94.8, -97.15, -95.73, -96.81, -95.9, -96.1, -96.3, -98.1, -95.36, -98.57, -97.3, -95.43, -98.57, -96.5, -96.5, -97.71, -96.773, -100.8, -106.54, -97.8, -97.1, -95.48, -94.9, -95.4, -95.59, -94.07, -98.61, -97.75, -95.41, -106.1, -97.5, -97.82, -97.8, -99.5, -95.7, -94.8, -99.83, -96.79, -97.8, -95.14, -95.41, -95.35, -101.89, -97.74, -95.5, -94.5, -95.42, -98.67, -97.72, -95.29, -98.48, -95.47, -96.4, -95.25, -95.1, -101.4, -96.6, -95.5, -98.51, -95.61, -96.81, -98.7, -98.49, -97.0, -96.1, -95.4, -96.63, -94.14, -95.64, -97.7, -97.07, -95.7, -96.75, -95.2, -98.18, -97.32, -97.81, -97.12, -95.61, -96.6, -95.18, -98.2, -98.47, -97.3, -96.91, -100.5, -95.9, -95.53, -95.54, -96.55, -97.6, -97.15, -96.1, -96.77, -96.98, -97.15, -95.53, -94.2, -95.2, -95.2, -97.7, -97.72, -94.7, -96.74, -98.2, -95.55, -94.6, -97.6, -96.98, -97.13, -96.1, -97.37, -95.9, -96.75, -94.17, -106.54, -97.13, -97.17, -94.7, -106.38, -97.5, -106.5, -97.2, -94.84, -95.56, -96.62, -94.4, -106.33, -96.99, -96.3, -98.7, -97.31, -106.38, -97.4, -95.6, -97.71, -98.1, -98.2, -97.1, -96.32, -106.43, -98.48, -95.65, -97.42, -97.38, -97.65, -94.3, -96.72, -103.4, -96.59, -111.89, -111.92, -112.0, -76.2, -77.27, -76.14, -77.48, -77.38, -77.0, -77.34, -78.97, -77.5, -77.46, -76.15, -122.58, -88.39, -87.83, -88.04, -87.99, -87.87, -81.63, -81.75, -81.66, -80.54, -110.8],
            lat: [62.0, 34.72, 34.4, 33.46, 33.51, 33.22, 32.9, 34.83, 33.4, 33.44, 31.19, 30.4, 30.7, 34.0, 33.54, 32.37, 31.3, 36.0, 34.5, 36.2, 36.2, 34.9, 33.2, 36.1, 34.7, 34.6, 36.3, 34.8, 34.74, 33.41, 33.32, 33.59, 32.24, 33.45, 33.38, 32.21, 33.28, 33.47, 34.9, 33.69, 33.67, 33.67, 33.51, 33.48, 33.63, 33.37, 33.3, 33.8, 32.34, 34.6, 32.47, 33.68, 33.32, 33.45, 33.31, 33.65, 34.0, 34.59, 33.61, 33.56, 32.24, 33.51, 33.2, 33.49, 33.51, 34.2, 33.48, 35.1, 33.62, 32.34, 33.67, 33.4, 33.34, 33.49, 36.8, 32.8, 37.98, 37.81, 36.9, 32.63, 34.17, 37.95, 38.02, 32.8, 32.69, 37.5, 34.0, 36.84, 33.59, 37.38, 34.065, 37.79, 36.58, 34.08, 32.75, 37.21, 33.9, 33.05, 33.0, 32.67, 38.1, 33.2, 37.68, 38.4, 39.73, 39.69, 38.85, 39.71, 39.7, 39.77, 39.98, 39.7, 39.9, 39.66, 39.56, 39.54, 39.3, 39.6, 40.02, 39.93, 39.5, 38.9, 39.2, 39.67, 39.5, 39.8, 39.82, 38.6, 39.75, 28.29, 28.8, 26.6, 28.62, 26.3, 28.5, 30.2, 26.45, 28.01, 27.99, 29.7, 28.59, 28.23, 28.5, 26.11, 26.63, 30.09, 27.44, 30.4, 26.59, 28.92, 27.09, 26.03, 25.99, 28.39, 27.78, 27.49, 29.15, 27.94, 26.06, 30.8, 28.08, 28.48, 26.92, 28.7, 26.62, 26.25, 26.14, 26.11, 28.51, 30.6, 26.84, 26.0, 26.64, 28.14, 26.31, 28.19, 29.15, 28.1, 27.3, 26.11, 25.93, 29.0, 28.63, 27.82, 26.71, 27.73, 29.3, 28.9, 26.85, 28.24, 28.61, 26.25, 26.76, 26.53, 27.79, 30.16, 28.66, 28.1, 24.6, 28.67, 26.13, 27.91, 28.71, 30.27, 28.67, 28.51, 26.27, 28.55, 26.6, 26.02, 27.28, 30.46, 30.8, 28.08, 28.45, 28.09, 28.23, 30.27, 27.94, 25.96, 27.98, 26.27, 28.1, 26.38, 29.8, 26.94, 29.68, 27.9, 27.1, 28.57, 26.19, 28.76, 28.21, 28.52, 26.35, 30.5, 28.29, 28.31, 28.5, 28.2, 28.6, 26.99, 27.84, 28.6, 26.03, 25.82, 30.37, 33.94, 33.49, 33.97, 34.59, 33.77, 34.8, 33.8, 33.8, 33.82, 32.47, 32.81, 33.6, 34.03, 33.1, 34.1, 33.42, 33.94, 34.95, 33.76, 33.5, 34.07, 33.98, 33.2, 33.97, 32.9, 33.86, 32.54, 33.95, 32.4, 32.54, 33.89, 34.01, 34.02, 33.93, 33.39, 41.69, 41.6, 41.2, 41.0, 41.4, 41.53, 41.7, 39.1, 41.78, 41.84, 38.6, 41.62, 41.79, 37.74, 38.9, 41.8, 42.28, 41.89, 41.93, 42.04, 42.05, 40.9, 41.95, 42.04, 42.41, 41.92, 41.71, 41.9, 42.38, 38.8, 42.01, 39.1, 42.23, 41.77, 38.3, 42.35, 38.6, 37.7, 42.06, 41.49, 41.3, 41.15, 41.59, 41.1, 40.5, 41.5, 41.07, 39.97, 41.05, 41.4, 41.62, 41.6, 41.7, 41.05, 41.55, 41.52, 41.72, 41.2, 41.69, 40.5, 41.45, 37.71, 38.85, 38.89, 37.8, 37.71, 38.1, 37.69, 38.92, 37.67, 37.7, 38.98, 39.4, 39.0, 37.4, 37.75, 39.2, 39.12, 39.0, 38.4, 38.93, 38.1, 37.686, 38.19, 38.1, 38.04, 37.99, 37.02, 37.6, 38.1, 37.9, 37.9, 37.8, 37.8, 30.01, 30.24, 31.26, 32.45, 32.5, 32.53, 31.28, 42.81, 42.32, 41.65, 41.72, 42.63, 41.7, 41.96, 42.59, 42.25, 42.09, 42.35, 41.7, 42.49, 42.35, 42.17, 42.25, 42.63, 42.34, 42.351, 41.64, 42.08, 42.5, 42.21, 42.65, 41.94, 42.19, 42.12, 42.63, 42.29, 42.33, 42.52, 38.99, 38.98, 39.09, 39.28, 38.93, 38.9, 38.8, 39.27, 39.39, 39.16, 39.43, 39.2, 39.0, 38.75, 38.81, 39.44, 42.6, 42.96, 42.9, 43.1, 43.0, 42.8, 42.52, 42.33, 42.46, 42.49, 42.21, 43.01, 40.2, 37.9, 36.7, 38.63, 39.04, 39.21, 39.7, 38.96, 38.97, 37.15, 38.65, 39.23, 38.9, 39.79, 38.81, 39.05, 38.8, 38.49, 39.08, 39.4, 32.33, 30.44, 30.3, 32.5, 32.28, 32.33, 31.5, 32.2, 31.3, 32.6, 30.5, 45.8, 35.13, 36.12, 36.3, 35.0, 35.57, 36.43, 35.95, 35.25, 35.4, 35.79, 35.7, 35.54, 35.9, 41.26, 42.3, 41.12, 41.5, 41.37, 41.24, 40.9, 40.8, 41.23, 40.6, 40.81, 39.5, 39.8, 32.6, 34.5, 32.3, 33.6, 32.4, 36.22, 36.23, 36.12, 36.06, 36.12, 36.28, 36.2, 36.4, 40.77, 41.44, 40.4, 41.44, 41.1, 39.5, 41.67, 39.65, 41.39, 41.39, 41.02, 36.7, 35.4, 35.52, 34.2, 34.0, 34.1, 34.57, 35.25, 36.1, 36.7, 35.51, 35.38, 35.5, 36.3, 35.6, 36.28, 36.5, 36.4, 35.58, 35.46, 35.23, 36.0, 35.46, 36.4, 35.3, 35.33, 36.8, 35.6, 35.72, 35.47, 35.41, 36.06, 35.0, 45.45, 41.41, 39.85, 41.1, 39.93, 40.95, 40.18, 40.02, 41.28, 39.91, 39.94, 39.97, 39.85, 40.0, 39.92, 40.06, 40.09, 40.05, 41.2, 39.95, 40.12, 40.21, 40.46, 41.42, 40.0, 39.98, 39.97, 39.88, 41.5, 40.3, 40.26, 40.04, 40.44, 41.96, 41.81, 34.1, 32.38, 33.99, 34.09, 34.84, 32.5, 32.2, 33.98, 34.14, 34.5, 35.87, 35.9, 36.0, 36.5, 36.11, 35.02, 35.5, 35.3, 35.7, 35.8, 36.0, 35.1, 36.07, 35.17, 36.3, 26.0, 29.74, 30.1, 30.49, 26.2, 31.5, 32.97, 35.21, 30.7, 33.22, 29.83, 33.04, 32.1, 33.2, 30.5, 29.7, 30.09, 29.46, 32.5, 29.83, 29.51, 32.1, 33.6, 30.26, 32.793, 35.6, 31.8, 30.0, 29.2, 29.65, 33.0, 32.8, 30.09, 30.05, 29.52, 30.4, 29.71, 31.8, 33.3, 30.5, 30.21, 27.8, 30.2, 31.4, 32.36, 32.9, 32.4, 29.55, 29.68, 29.54, 33.57, 30.29, 29.8, 31.6, 29.72, 29.46, 30.53, 32.32, 33.91, 30.14, 32.9, 29.76, 29.56, 32.3, 33.76, 30.18, 29.65, 29.62, 33.08, 33.1, 29.46, 28.9, 33.1, 29.2, 32.82, 33.52, 29.56, 26.2, 32.94, 30.3, 33.02, 29.62, 26.28, 32.73, 30.3, 33.03, 29.92, 32.4, 29.98, 32.8, 29.29, 26.0, 32.63, 31.3, 28.9, 30.04, 30.2, 32.89, 31.8, 31.52, 32.9, 33.16, 28.81, 32.96, 29.69, 33.4, 31.9, 31.8, 31.0, 30.43, 32.6, 32.97, 30.6, 29.66, 31.7, 27.84, 32.92, 32.69, 32.28, 27.63, 33.3, 32.88, 30.1, 31.85, 32.57, 33.12, 32.3, 31.75, 27.7, 31.78, 33.7, 32.52, 29.74, 32.77, 32.5, 31.79, 32.78, 32.9, 29.9, 27.91, 31.79, 27.77, 29.79, 30.38, 27.7, 29.1, 33.15, 30.66, 31.89, 29.33, 29.64, 32.66, 32.74, 31.06, 32.1, 32.95, 30.0, 33.18, 40.71, 40.66, 41.05, 36.76, 38.94, 36.91, 39.05, 38.88, 36.7, 38.96, 38.1, 36.7, 38.82, 36.84, 45.62, 43.05, 42.62, 43.09, 42.96, 42.73, 38.35, 38.31, 38.31, 37.73, 41.3],
            marker: {
                size: 5,
                color: 'green'
            }
        }];
        var layoutMap = {
            title: "Green Imaging Clinics",
            mapbox:{
                style: 'open-street-map',
                center: { lat: 38, lon: -90 },
                zoom: 3
            }

        };
        Plotly.newPlot("map", map, layoutMap);

}
